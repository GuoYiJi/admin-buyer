global.webpackJsonp([65],{"+8J8":function(t,s,i){"use strict";var e=i("woOf"),o=i.n(e),n=i("Xxa5"),a=i.n(n),c=i("exGp"),l=i.n(c),r=i("Dd8w"),u=i.n(r),d=i("qTHA"),v=i("Vk0E"),m=i("cyB7"),f=i("90m7"),p=i("QmSG"),g=i("NYxO");s.a={mixins:[f.a],components:{ibox:v.a,btn:m.a},data:function(){return{typeText:"",colorText:"",showColor:!1,showTag:!1,selectColor:[],selectTag:[],imgList:[],lineList:[],colorArr:[],typeArr:[]}},computed:u()({},Object(g.b)(["goodsDetail"]),{selColor:function(){return this.selectColor.join(",")},selTag:function(){return this.selectTag.join(",")}}),methods:{comfirmType:function(t){if(this.toClose(t),"showColor"==t){for(var s=[],i=0;e=this.colorArr[i++];)e.select&&s.push(e.name);this.selectColor=s}if("showTag"==t){var e,o=[];for(i=0;e=this.typeArr[i++];)e.select&&o.push(e.name);this.selectTag=o}this.addLine()},selects:function(t,s){this.$set(this[s][t],"select",!this[s][t].select)},addLine:function(){if(this.selectColor.length>0&&this.selectTag.length>0){var t=[],s=[],i=[],e=this.goodsDetail;e&&e.sku&&e.sku.skuList&&(i=e.sku.skuList);for(var o,n=0;o=this.selectColor[n++];)for(var a,c=function(){var e={},c=o+","+a;i.some(function(t){if(t.skuCode===c)return e={id:t.id,num:t.stock},!0});var r={id:String(n)+String(l),img:""};t.push(r);var d=u()({id:"",color:o,tag:a,num:100},e);s.push(d)},l=0;a=this.selectTag[l++];)c();this.imgList=t,this.lineList=s}},delLine:function(t){this.lineList.splice(t,1),this.imgList.splice(t,1);var s=[],i=[];this.lineList.forEach(function(t){s.indexOf(t.color)||s.push(t.color),i.indexOf(t.tag)||i.push(t.tag)}),this.selectColor=s,this.selectTag=i,this.colorArr=this.colorArr.map(function(t){return-1===s.indexOf(t.name)&&(t.select=!1),t}),this.typeArr=this.typeArr.map(function(t){return console.log(!i.indexOf(t.name)),-1===i.indexOf(t.name)&&(t.select=!1),t})},bindButtonTap:function(t){d.a.showLoading();var s=this;d.a.chooseImage({sizeType:"original",count:1,success:function(i){console.log(i);var e=i.tempFilePaths;console.log(e);for(var o,n=0;o=e[n++];)s.uploadImg(o,t)},complete:function(){d.a.hideLoading()}})},toCancel:function(t){this.$set(this.imgList[t],"img","")},uploadImg:function(t,s){var i=this,e=t.lastIndexOf("/")+1;console.log(t.slice(e).toString()),d.a.uploadFile({url:p.a.uploadImageUrl,filePath:t,name:"file",formData:{name:t.slice(e).toString(),key:"img/${filename}",policy:p.a.imgPolicy,OSSAccessKeyId:p.a.OSSAccessKeyId,success_action_status:"200",signature:p.a.imgSignature},success:function(o){if(console.log(o),400==o.statusCode)i.handleError("上传的图片大小不能超过2m!");else if(200==o.statusCode){var n=p.a.uploadImageUrl+"/img/"+t.slice(e).toString();i.$set(i.imgList[s],"img",n)}},fail:function(t){console.log(t)}})},confirm:function(){for(var t,s=this,i=function(t){for(var i,e=0;i=s.colorArr[e++];)if(t==i.name)return i.id},e=function(t){for(var i,e=0;i=s.typeArr[e++];)if(t==i.name)return i.id},o=[],n=0;t=this.imgList[n++];){var a={skuCode:this.lineList[n-1].color+","+this.lineList[n-1].tag,stock:this.lineList[n-1].num,image:t.img,id:this.lineList[n-1].id,attrIds:i(this.lineList[n-1].color)+","+e(this.lineList[n-1].tag)};o.push(a)}this.goodsId?d.a.showModal({title:"修改规格",content:"您确定要修改商品规格吗？",success:function(t){t.confirm&&s.$API.editShopType({skuList:o,goodsId:s.goodsId}).then(function(t){1===t.code&&(s.$store.commit("ADDSHOPTYPE",o),s.$router.back(-1))}).catch(function(t){})}}):(this.$store.commit("ADDSHOPTYPE",o),this.$router.back(-1))}},mounted:function(){var t=this;return l()(a.a.mark(function s(){var i,e,o,n,c,l,r,d,v,m;return a.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return t.goodsId=t.$route.query.goodsId,s.prev=1,(i=t.goodsDetail)&&i.sku&&(e=i.sku,o=[],n=[],console.log(e.skuList),e.skuList.forEach(function(t,s){o[s]=u()({},t,{img:t.image}),n[s]=u()({},t,{color:t.skuCode.split(",")[0],tag:t.skuCode.split(",")[1],num:t.stock})}),t.imgList=o,t.lineList=n,e.specGroup.forEach(function(s){var i=void 0;switch(s.enValue){case"color":i="selectColor";break;case"size":i="selectTag"}i&&(t[i]=s.specAttr.map(function(t){return t.name}))})),s.next=6,t.$API.s_searchType({specId:1});case 6:for(c=s.sent,l=0;r=c.data[l++];)r.select=!1;return s.next=10,t.$API.s_searchType({specId:2});case 10:for(d=s.sent,v=0;m=d.data[v++];)m.select=!1;t.colorArr=c.data.map(function(t){return i&&i.sku&&-1!==i.sku.specGroup[0].specAttr.findIndex(function(s){return s.id===t.id})&&(t.select=!0),t}),t.typeArr=d.data.map(function(t){return i&&i.sku&&-1!==i.sku.specGroup[1].specAttr.findIndex(function(s){return s.id===t.id})&&(t.select=!0),t}),s.next=19;break;case 16:s.prev=16,s.t0=s.catch(1),console.log(s.t0);case 19:case"end":return s.stop()}},s,t,[[1,16]])}))()},onUnload:function(){o()(this,this.$options.data())}}},"2srT":function(t,s){},AvjR:function(t,s,i){"use strict";var e=i("+8J8"),o=i("T+iw");var n=function(t){i("2srT")},a=i("ybqe")(e.a,o.a,n,"data-v-21c5fb26",null);s.a=a.exports},"T+iw":function(t,s,i){"use strict";var e={render:function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"home"},[i("div",{staticClass:"box_content"},[i("div",{staticClass:"line b_line",attrs:{eventid:"0"},on:{click:function(s){t.toOpen("showColor")}}},[i("p",{staticClass:"input"},[t._v("颜色：")]),t._v(" "),i("p",{staticClass:"blur"},[t._v(t._s(t.selectColor.length>0?t.selColor:"点击选择颜色"))])],1),t._v(" "),i("div",{staticClass:"line b_line",attrs:{eventid:"1"},on:{click:function(s){t.toOpen("showTag")}}},[i("p",{staticClass:"input"},[t._v("尺码：")]),t._v(" "),i("p",{staticClass:"blur"},[t._v(t._s(t.selectTag.length>0?t.selTag:"点击选择尺码"))])],1)]),t._v(" "),i("div",{staticClass:"add_video"},[i("div",{staticClass:"v_box"},t._l(t.imgList,function(s,e){return i("div",{key:e},[i("div",{staticClass:"add_videos"},[s.img?i("div",{staticClass:"add img_list "},[i("img",{staticClass:"item_img",attrs:{src:s.img}}),t._v(" "),i("i",{staticClass:"cancel_shop",attrs:{eventid:"2-"+e},on:{click:function(s){t.toCancel(e)}}}),t._v(" "),i("div",{staticClass:"tips_bg"},[t._v(t._s(t.lineList[e].color+" "+t.lineList[e].tag))])],1):i("div",{staticClass:"add add_box"},[i("div",[i("p",{attrs:{eventid:"3-"+e},on:{tap:function(s){t.bindButtonTap(e)}}},[t._v(t._s(t.lineList[e].color+" "+t.lineList[e].tag))])],1)])])])}))]),t._v(" "),i("div",{staticClass:"line_box"},t._l(t.lineList,function(s,e){return i("div",{key:e,staticClass:"add_line b_line"},[i("p",[t._v(t._s(s.color))]),t._v(" "),i("p",[t._v(t._s(s.tag))]),t._v(" "),i("p",{staticClass:"num"},[i("input",{directives:[{name:"model",rawName:"v-model",value:s.num,expression:"item.num"}],staticClass:"input_num",attrs:{min:"0",eventid:"4-"+e},domProps:{value:s.num},on:{input:function(t){t.target.composing||(s.num=t.target.value)}}})]),t._v(" "),i("p",{staticClass:"del",attrs:{eventid:"5-"+e},on:{click:function(s){t.delLine(e)}}},[t._v("删除")])],1)})),t._v(" "),t.showColor?i("div",{staticClass:"modal_box"},[i("div",{staticClass:"modal_time"},[i("div",{staticClass:"top"},[i("p",{staticClass:"cancel",attrs:{eventid:"6"},on:{click:function(s){t.toClose("showColor")}}},[t._v("取消")]),t._v(" "),i("p",{staticClass:"title"},[t._v("选择颜色")]),t._v(" "),i("p",{staticClass:"confirm",attrs:{eventid:"7"},on:{click:function(s){t.comfirmType("showColor")}}},[t._v("确定")])],1),t._v(" "),i("div",{staticClass:"content content_tag"},t._l(t.colorArr,function(s,e){return i("div",{key:e,staticClass:"tag_item",attrs:{eventid:"8-"+e},on:{click:function(s){t.selects(e,"colorArr")}}},[i("i",{staticClass:"select",class:[s.select&&"select-active"]}),t._v(" "),i("p",[t._v(t._s(s.name))])],1)}))])]):t._e(),t._v(" "),t.showTag?i("div",{staticClass:"modal_box"},[i("div",{staticClass:"modal_time"},[i("div",{staticClass:"top"},[i("p",{staticClass:"cancel",attrs:{eventid:"9"},on:{click:function(s){t.toClose("showTag")}}},[t._v("取消")]),t._v(" "),i("p",{staticClass:"title"},[t._v("选择尺码")]),t._v(" "),i("p",{staticClass:"confirm",attrs:{eventid:"10"},on:{click:function(s){t.comfirmType("showTag")}}},[t._v("确定")])],1),t._v(" "),i("div",{staticClass:"content content_tag"},t._l(t.typeArr,function(s,e){return i("div",{key:e,staticClass:"tag_item",attrs:{eventid:"11-"+e},on:{click:function(s){t.selects(e,"typeArr")}}},[i("i",{staticClass:"select",class:{"select-active":s.select}}),t._v(" "),i("p",[t._v(t._s(s.name))])],1)}))])]):t._e(),t._v(" "),i("div",{staticClass:"bottom"}),t._v(" "),i("div",{staticClass:"create"},[i("p",{attrs:{eventid:"12"},on:{click:t.confirm}},[t._v("确定")])],1)])},staticRenderFns:[]};s.a=e}},["uCWr"]);