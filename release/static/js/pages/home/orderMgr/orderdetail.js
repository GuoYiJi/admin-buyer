global.webpackJsonp([43],{"7WCK":function(t,s,e){"use strict";var i=e("mvHQ"),a=e.n(i),o=e("qTHA"),n=(e("90m7"),e("QmSG"));s.a={data:{showEditTable:!1,isEdited:!1,isHasDeliver:!1,popupsIndex:-1,isPing:0,isHasChildren:0,orderId:"",state:"",shopName:"",orderAddress:{},remark:"无",goodsList:[],pingUser:[],skuList:[],lastSkuList:[],deliverList:[],editGoodsArr:[],totalPrice:0,childrenOrder:[],orderNo:"",couponMoney:0,freight:0,parentNo:"",createTime:"",payTime:"",deliverTime:"",pingTime:"",receiptTime:"",showPopups:!1,showLogistics:!1,noExpress:!1,imageList:[],imgList:[],maxNum:6,index:0,companies:[{text:"-请选择物流公司-",type:0},{text:"顺丰速运",type:1},{text:"邮政EMS",type:2},{text:"圆通快递",type:3},{text:"申通快递",type:4},{text:"韵达快递",type:5},{text:"百世汇通",type:6},{text:"中通快递",type:7},{text:"天天快递",type:8},{text:"优速物流",type:9}],visible1:!1,visible3:!1,visible4:!1},computed:{orderAddressValue:function(){if(this.orderAddress.value)return this.orderAddress.value.replace(/,/g,"-")+"-"},isPersonal:function(){return o.a.getStorageSync("isPersonal")&&1==o.a.getStorageSync("isPersonal")?1:0}},methods:{pageTo:function(t,s){this.$router.push({path:t,query:{orderId:s}})},closeOrder:function(t){var s=this;this.$API.L_shopClose({orderId:t}).then(function(t){o.a.showToast({title:"已取消",icon:"success"}),setTimeout(function(){s.pageStart()},1e3)})},getOrderDetail:function(t){return this.$API.L_selectOrderDetail({orderId:t})},handle:function(t){console.log(t.mp.detail.value),this.index=t.mp.detail.value},getRefundOrderDetail:function(t){return this.$API.L_selectOrderRefundDetail({orderRefundId:t})},togglePopups:function(t){this.showPopups=!0,this.popupsIndex=t,this.isEdited=!1},cancelExpress:function(){this.showLogistics=!this.showLogistics},confirmExpress:function(t){var s=this;if(this.noExpress)this.confirmShip({orderId:t}).then(function(t){o.a.showToast({title:"已发货",icon:"success"}),s.showLogistics=!1,setTimeout(function(){s.pageStart()},1500)});else{if(0===this.index)return void o.a.showToast({title:"请选择物流公司",icon:"none"});if(!this.logisticsNo)return void o.a.showToast({title:"请填写物流单号",icon:"none"});if(this.logisticsNo.length>14)return void o.a.showToast({title:"快递单号长度最长14位",icon:"none"});this.confirmShip({orderId:t,logisticsNo:this.logisticsNo,image:this.imgList.toString(),type:1}).then(function(t){o.a.showToast({title:"已发货",icon:"success"}),s.showLogistics=!1,setTimeout(function(){s.pageStart()},1500)})}},togglenoExpress:function(){this.noExpress=!this.noExpress,console.log(this.noExpress)},confirmShip:function(t){return this.$API.L_deliverGoods(t)},cancelModel:function(){this.showPopups=!1,this.showLogistics=!1,this.popupsIndex=-1},ship:function(t){!this.isEdited&&this.deliverList&&this.deliverList.every(function(t){return t.every(function(t){return 0===t.deliver})})?this.visible1=!this.visible1:this.isEdited&&this.lastSkuList&&this.lastSkuList.every(function(t){return t.every(function(t){return 0===t.deliver})})?this.visible1=!this.visible1:this.showLogistics=!this.showLogistics},bindButtonTapImage:function(){var t=this.maxNum;o.a.showLoading({title:"加载中"});var s=this;if(t&&this.imgList.length>=t)return this.handleError("不能超过"+t+"张图片噢！"),void o.a.hideLoading();o.a.chooseImage({sizeType:"original",count:this.uploadNum,success:function(t){console.log(t);var e=t.tempFilePaths;console.log(e),e.forEach(function(t){s.uploadImg(t)})},fail:function(){o.a.showLoading({title:"操作失败"})},complete:function(){o.a.hideLoading()}})},uploadImg:function(t){var s=t.lastIndexOf("/")+1,e=this;o.a.uploadFile({url:n.a.uploadImageUrl,filePath:t,name:"file",formData:{name:t.slice(s).toString(),key:"img/${filename}",policy:n.a.imgPolicy,OSSAccessKeyId:n.a.OSSAccessKeyId,success_action_status:"200",signature:n.a.imgSignature},success:function(i){if(console.log(i),console.log("tempFilePath  ========",t),400==parseInt(i.statusCode))e.handleError("上传的图片大小不能超过2m!");else if(200==parseInt(i.statusCode)){if(e.maxNum&&e.imgList.length>=e.maxNum)return void e.handleError("不能超过6张图片噢！");e.imgList.push(n.a.uploadImageUrl+"/img/"+t.slice(s).toString()),console.log("图片列表===>"+e.imgList),e.getImg(n.a.uploadImageUrl+"/img/"+t.slice(s).toString())}},fail:function(t){console.log(t)}}).onProgressUpdate(function(t){100===t.progress&&o.a.showToast({title:"上传完成"})})},getImg:function(t){this.imageList.push(t),console.log("imageList ===> "+this.imageList)},handleError:function(t){this.$Message({content:t,type:"error"})},cut:function(t,s){this.$set(this.lastSkuList[t],s,{deliver:this.lastSkuList[t][s].deliver-=1,color:this.lastSkuList[t][s].color,size:this.lastSkuList[t][s].size,num:this.lastSkuList[t][s].num,remain:this.lastSkuList[t][s].remain,skuId:this.lastSkuList[t][s].skuId}),console.log(this.lastSkuList[t])},add:function(t,s){this.$set(this.lastSkuList[t],s,{deliver:this.lastSkuList[t][s].deliver+=1,color:this.lastSkuList[t][s].color,size:this.lastSkuList[t][s].size,num:this.lastSkuList[t][s].num,remain:this.lastSkuList[t][s].remain,skuId:this.lastSkuList[t][s].skuId}),console.log(this.lastSkuList[t])},cancel:function(t){this.showPopups=!1,this.popupsIndex=-1},save:function(){var t=[],s=this;this.lastSkuList.forEach(function(s,e){s.forEach(function(s){t.push({num:s.deliver,skuId:s.skuId})})}),console.log("skuIdArr ==== >",t),o.a.request({url:n.a.url+"/api/order/goods/addChildren",method:"POST",dataType:"json",data:{shopId:n.a.appId,sessionId:o.a.getStorageSync("sessionId"),orderIds:s.orderId,orderDeliver:t},success:function(t){s.showEditTable=!0,s.isEdited=!0,s.skuList=JSON.parse(a()(s.lastSkuList)),console.log(s.isEdited)},complete:function(t){s.showPopups=!1,s.popupsIndex=-1}})},toggleModal:function(t){console.log("点击事件执行"),this[t]=!this[t]},pageStart:function(){var t=this;this.showLogistics=!1,console.log(this.showLogistics),this.$route.query.orderId&&(this.orderId=this.$route.query.orderId,this.getOrderDetail(this.orderId).then(function(s){if(console.log(s),t.state=s.data.state,s.data.orderAddress&&(t.orderAddress=s.data.orderAddress),t.goodsList=s.data.goodsList,t.goodsList){var e=[];t.goodsList.forEach(function(t,s){e.push([]),t.orderGoods.forEach(function(t){e[s].push({color:t.skuCode.split(",")[0].toString(),size:t.skuCode.split(",")[1].toString(),num:t.num,deliver:0,remain:t.remainNum,skuId:t.skuId})})}),t.skuList=e,t.lastSkuList=e}if(t.orderNo=s.data.orderNo,t.createTime=s.data.createTime,t.isPing=s.data.isPing,t.totalPrice=s.data.paid,t.freight=s.data.freight,1===s.data.isHasChildren?(t.isHasChildren=1,t.childrenOrder=s.data.children):(t.isHasChildren=0,t.childrenOrder=[]),s.data.payTime?t.payTime=s.data.payTime:t.payTime="",s.data.remark?t.remark=s.data.remark:t.remark="",s.data.deliverTime?t.deliverTime=s.data.deliverTime:t.deliverTime="",s.data.receiptTime?t.receiptTime=s.data.receiptTime:t.receiptTime="",s.data.couponMoney?t.couponMoney=s.data.couponMoney:t.couponMoney=0,s.data.pingTime?t.pingTime=s.data.pingTime:t.pingTime="",s.data.parent?t.parentNo=s.data.parent.orderNo:t.parentNo="",s.data.pingUser?t.pingUser=s.data.pingUser:t.pingUser=[],t.isHasDeliver=s.data.isHasDeliver,t.isHasDeliver){var i=[];t.goodsList.forEach(function(t,s){i.push([]),t.deliverList.forEach(function(t){i[s].push({color:t.skuCode.split(",")[0].toString(),size:t.skuCode.split(",")[1].toString(),num:t.num,deliver:t.canDeliverNumber,remain:t.remainNum})})}),t.deliverList=i,console.log("this.deliverList",t.deliverList)}else t.deliverList=[]})),o.a.getStorageSync("dpName")&&(this.shopName=o.a.getStorageSync("dpName"))}},mounted:function(){this.pageStart()}}},JF7t:function(t,s,e){"use strict";var i=e("7WCK"),a=e("Xpyf");var o=function(t){e("zLbf")},n=e("ybqe")(i.a,a.a,o,"data-v-68f90aa0",null);s.a=n.exports},Xpyf:function(t,s,e){"use strict";var i={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"wrapper"},[e("div",{staticClass:"receiver"},[e("div",{staticClass:"left-icon"}),t._v(" "),e("div",{staticClass:"right-info"},[e("div",{staticClass:"header"},[e("span",{staticClass:"name"},[t._v("收货人: "+t._s(t.orderAddress.name||"未知联系人"))]),t._v(" "),e("span",{staticClass:"mobile"},[t._v(t._s(t.orderAddress.mobile||"未知号码"))])]),t._v(" "),e("div",{staticClass:"address"},[t._v("收货地址: "+t._s(t.orderAddressValue+t.orderAddress.address))]),t._v(" "),e("div",{staticClass:"remark"},[t._v("备注: "+t._s(t.remark))])])]),t._v(" "),e("div",{staticClass:"orderDetail"},[e("div",{staticClass:"header"},[e("span",{staticClass:"left"},[e("i",{staticClass:"icon"}),t._v(t._s(t.shopName)+"\n        ")],1),t._v(" "),e("span",{staticClass:"right"},[t._v(t._s(1===t.state?"等待支付":2===t.state?"已取消":5===t.state?"待发货":6===t.state?"已发货":7===t.state?"交易成功":8===t.state?"交易关闭":9===t.state?"拼单中":10===t.state?"审核中":"未知状态"))])]),t._v(" "),t._l(t.goodsList,function(s,i){return e("div",{key:i,staticClass:"goods-info"},[e("div",{staticClass:"goods-body"},[e("i",{staticClass:"goods-img",style:{backgroundImage:"url("+s.image+")"}}),t._v(" "),e("div",{staticClass:"goods-message"},[e("span",{staticClass:"name"},[t._v(t._s(s.name))]),t._v(" "),e("span",[e("p",{staticClass:"stall"},[t._v("档口名称: "+t._s(s.stallInfo3||"未知档口"))]),t._v(" "),e("p",{staticClass:"futures"},[t._v("期货: "+t._s(s.delivery||"未知期货"))])],1),t._v(" "),e("div",{staticClass:"footer"},[e("div",{staticClass:"box"},t._l(t.skuList[i],function(s,i){return e("span",{key:i},[t._v(t._s(s.color)+"色: "+t._s(s.size)+"码丨"+t._s(s.num)+"件")])})),t._v(" "),e("button",{directives:[{name:"show",rawName:"v-show",value:5===t.state,expression:"state === 5"}],attrs:{eventid:"0-"+i},on:{click:function(s){t.togglePopups(i)}}},[t._v("编辑")])],1)])],1),t._v(" "),5==t.state&&t.isHasDeliver&&!t.isEdited?e("div",{staticClass:"table"},[e("table",{staticStyle:{border:"none"}},[e("tr",[e("th",[t._v("颜色")]),t._v(" "),e("th",[t._v("码数")]),t._v(" "),e("th",[t._v("总件数")]),t._v(" "),e("th",[t._v("待发件数")]),t._v(" "),e("th",[t._v("剩余待发")])],1),t._v(" "),t._l(t.deliverList[i],function(s,i){return e("tr",{key:i},[e("td",[t._v(t._s(s.color))]),t._v(" "),e("td",[t._v(t._s(s.size))]),t._v(" "),e("td",[t._v(t._s(s.num))]),t._v(" "),e("td",[t._v(t._s(s.deliver))]),t._v(" "),e("td",[t._v(t._s(s.remain))])],1)})],2)],1):t._e(),t._v(" "),t.isEdited?e("div",{staticClass:"table"},[e("table",{staticStyle:{border:"none"}},[e("tr",[e("th",[t._v("颜色")]),t._v(" "),e("th",[t._v("码数")]),t._v(" "),e("th",[t._v("总件数")]),t._v(" "),e("th",[t._v("待发件数")]),t._v(" "),e("th",[t._v("剩余待发")])],1),t._v(" "),t._l(t.skuList[i],function(s,i){return e("tr",{key:i},[e("td",[t._v(t._s(s.color))]),t._v(" "),e("td",[t._v(t._s(s.size))]),t._v(" "),e("td",[t._v(t._s(s.num))]),t._v(" "),e("td",[t._v(t._s(s.deliver))]),t._v(" "),e("td",[t._v(t._s(s.remain))])],1)})],2)],1):t._e(),t._v(" "),e("div",{staticClass:"total"},[t._v("\n        共"+t._s(s.countNum)+"件商品, 合计: "),e("strong",[t._v(t._s(s.countPrice)+"元")])],1),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.popupsIndex===i,expression:"popupsIndex === goodsIndex"}],staticClass:"popups"},[e("table",[e("tr",{staticClass:"header"},[e("th",[t._v("颜色")]),t._v(" "),e("th",[t._v("码数")]),t._v(" "),e("th",[t._v("总件数")]),t._v(" "),e("th",{staticClass:"col-2"},[t._v("待发件数")]),t._v(" "),e("th",[t._v("剩余待发")])],1),t._v(" "),t._l(t.lastSkuList[i],function(s,a){return e("tr",{key:a},[e("td",[t._v(t._s(s.color))]),t._v(" "),e("td",[t._v(t._s(s.size))]),t._v(" "),e("td",[t._v(t._s(s.num))]),t._v(" "),e("td",{staticClass:"col-2"},[e("button",{attrs:{disabled:0===s.deliver,eventid:"1-"+i+"-"+a},on:{click:function(s){t.cut(i,a)}}},[t._v("-")]),t._v(" "),e("span",{staticClass:"edit"},[t._v(t._s(s.deliver))]),t._v(" "),e("button",{attrs:{disabled:s.deliver===s.remain,eventid:"2-"+i+"-"+a},on:{click:function(s){t.add(i,a)}}},[t._v("+")])],1),t._v(" "),e("td",[t._v(t._s(s.remain))])],1)})],2),t._v(" "),e("div",{staticClass:"btn-group"},[e("button",{staticClass:"cancel",attrs:{type:"button",eventid:"3-"+i},on:{click:function(s){t.cancel(i)}}},[t._v("取消")]),t._v(" "),e("button",{staticClass:"save",attrs:{type:"button",eventid:"4-"+i},on:{click:function(s){t.save()}}},[t._v("保存")])],1)],1)])})],2),t._v(" "),0!==t.childrenOrder.length?e("ul",{staticClass:"childOrder"},t._l(t.childrenOrder,function(s,i){return e("li",{key:i,attrs:{eventid:"5-"+i},on:{click:function(e){t.pageTo("/pages/home/orderMgr/orderdetail",s.id)}}},[t._v("\n      子订单编号("+t._s(1===s.state?"等待支付":2===s.state?"已取消":5===s.state?"待发货":6===s.state?"已发货":7===s.state?"交易成功":8===s.state?"交易关闭":9===s.state?"拼单中":10===s.state?"审核中":"未知状态")+"):\n      "+t._s(s.orderNo))])})):t._e(),t._v(" "),e("ul",{staticClass:"orderPrice"},[e("li",[e("span",{staticClass:"title"},[t._v("商品总价")]),t._v(" "),e("span",{staticClass:"num"},[t._v("￥"+t._s(t.totalPrice))])]),t._v(" "),t.couponMoney?e("li",[e("span",{staticClass:"title"},[t._v("优惠券抵扣")]),t._v(" "),e("span",{staticClass:"num"},[t._v("- ￥"+t._s(t.couponMoney))])]):t._e(),t._v(" "),e("li",[e("span",{staticClass:"title"},[t._v("运费")]),t._v(" "),e("span",{staticClass:"num"},[t._v("+ ￥"+t._s(t.freight))])])],1),t._v(" "),e("ul",{staticClass:"orderNo"},[t.parentNo?e("li",[t._v("父订单编号: "+t._s(t.parentNo))]):t._e(),t._v(" "),e("li",[t._v("订单编号: "+t._s(t.orderNo))]),t._v(" "),e("li",[t._v("下单时间: "+t._s(t.createTime))]),t._v(" "),t.payTime?e("li",[t._v("支付时间: "+t._s(t.payTime))]):t._e(),t._v(" "),t.pingTime?e("li",[t._v("拼团时间: "+t._s(t.pingTime))]):t._e(),t._v(" "),t.deliverTime?e("li",[t._v("发货时间: "+t._s(t.deliverTime))]):t._e(),t._v(" "),t.receiptTime?e("li",[t._v("确认收货时间: "+t._s(t.receiptTime))]):t._e()],1),t._v(" "),e("div",{staticClass:"white-block",staticStyle:{width:"100%",height:"100px","background-color":"#fff"}}),t._v(" "),e("div",{staticClass:"btn"},[t.pingUser?e("div",{staticClass:"pingUser"},t._l(t.pingUser,function(s,i){return i<3?e("i",{key:i,style:{backgroundImage:"url("+s.head+")"}}):t._e()})):t._e(),t._v(" "),5===t.state?e("button",{attrs:{eventid:"6"},on:{click:function(s){t.ship(t.orderId)}}},[t._v("发货")]):t._e(),t._v(" "),6===t.state&&1!==t.isHasChildren?e("button",{attrs:{eventid:"7"},on:{click:function(s){t.pageTo("/pages/home/orderMgr/logisticsDetail",t.orderId)}}},[t._v("查看物流")]):t._e(),t._v(" "),4===t.state?e("button",[t._v("确认收货")]):t._e(),t._v(" "),1===t.state&&0===t.isPersonal?e("button",[t._v("确认已支付")]):t._e(),t._v(" "),1===t.state?e("button",{attrs:{eventid:"8"},on:{click:function(s){t.toggleModal("visible3")}}},[t._v("取消订单")]):t._e()],1),t._v(" "),t.showLogistics?e("div",{staticClass:"logistics"},[e("div",{staticClass:"wrapper"},[e("div",{staticClass:"title"},[t._v("请填写物流信息")]),t._v(" "),e("ul",{staticClass:"body"},[e("li",[t._v("\n          物流公司:\n          "),e("div",{staticClass:"selector-picker"},[e("picker",{attrs:{mode:"selector",value:t.index,range:t.companies,"range-key":"text",eventid:"9"},on:{change:t.handle}},[e("div",{staticClass:"picker"},[t._v("\n                "+t._s(t.companies[t.index].text)+"\n              ")])])],1)]),t._v(" "),e("li",[t._v("\n          快递单号:\n          "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.logisticsNo,expression:"logisticsNo"}],attrs:{type:"number",placeholder:"请填写快递单号",eventid:"10"},domProps:{value:t.logisticsNo},on:{input:function(s){s.target.composing||(t.logisticsNo=s.target.value)}}})]),t._v(" "),e("li",[t._v("上传快递信息凭证: ")]),t._v(" "),e("li",{staticClass:"upload-img"},[e("scroll-view",{staticClass:"scroll-view",staticStyle:{height:"220rpx"},attrs:{"scroll-y":""}},[t._l(t.imageList,function(t,s){return e("div",{key:s,staticClass:"img-box"},[e("i",{staticClass:"img",style:{backgroundImage:"url("+t+")"}})],1)}),t._v(" "),e("div",{staticClass:"img-box"},[e("i",{staticClass:"add-img",attrs:{eventid:"11"},on:{tap:t.bindButtonTapImage}},[t._v("\n                + 可上传图片\n              ")])],1)],2)],1),t._v(" "),e("li",{staticClass:"checkbox"},[e("i",{staticClass:"select-icon",class:[t.noExpress?"active":""],attrs:{eventid:"12"},on:{click:function(s){t.togglenoExpress()}}}),t._v("\n          无物流信息\n        ")],1)],1),t._v(" "),e("div",{staticClass:"footer"},[e("span",{staticClass:"cancel",attrs:{eventid:"13"},on:{click:function(s){t.cancelExpress()}}},[t._v("取消")]),t._v(" "),e("span",{staticClass:"ok",attrs:{eventid:"14"},on:{click:function(s){t.confirmExpress(t.orderId)}}},[t._v("确定发货")])])],1)]):t._e(),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showLogistics||t.showPopups,expression:"showLogistics || showPopups"}],staticClass:"mark",attrs:{eventid:"15"},on:{click:t.cancelModel}}),t._v(" "),e("i-modal",{attrs:{title:"请检查...",visible:t.visible1,eventid:"16",mpcomid:"0"},on:{ok:function(s){t.toggleModal("visible1")},cancel:function(s){t.toggleModal("visible1")}}},[e("div",[t._v("未编辑待发货数量")])]),t._v(" "),e("i-modal",{attrs:{visible:t.visible3,eventid:"17",mpcomid:"1"},on:{ok:function(s){t.closeOrder(t.orderId)},cancel:function(s){t.toggleModal("visible3")}}},[e("div",{staticClass:"visible"},[t._v("确定取消订单？")])]),t._v(" "),e("i-modal",{attrs:{visible:t.visible4,eventid:"18",mpcomid:"2"},on:{ok:function(s){t.closeOrder(t.orderItem.id)},cancel:function(s){t.toggleModal("visible4")}}},[e("div",{staticClass:"visible"},[t._v("确定关闭订单？")])]),t._v(" "),e("i-message",{attrs:{id:"message",mpcomid:"3"}})],1)},staticRenderFns:[]};s.a=i},zLbf:function(t,s){}},["BQ9p"]);