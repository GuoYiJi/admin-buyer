global.webpackJsonp([44],{"7WCK":function(t,s,i){"use strict";var e=i("mvHQ"),a=i.n(e),o=i("woOf"),n=i.n(o),r=i("qTHA"),l=(i("90m7"),i("QmSG"));s.a={data:{showEditTable:!1,isEdited:!1,isHasDeliver:!1,popupsIndex:-1,isPing:0,isHasChildren:0,orderId:"",state:"",shopName:"",orderAddress:{},remark:"无",goodsList:[],pingUser:[],skuList:[],lastSkuList:[],deliverList:[],editGoodsArr:[],totalPrice:0,childrenOrder:[],orderNo:"",couponMoney:0,freight:0,parentNo:"",createTime:"",payTime:"",deliverTime:"",pingTime:"",receiptTime:"",showPopups:!1,showLogistics:!1,noExpress:!1,imageList:[],imgList:[],maxNum:6,index:0,companies:[{text:"-请选择物流公司-",type:0},{text:"顺丰速运",type:1},{text:"邮政EMS",type:2},{text:"圆通快递",type:3},{text:"申通快递",type:4},{text:"韵达快递",type:5},{text:"百世汇通",type:6},{text:"中通快递",type:7},{text:"天天快递",type:8},{text:"优速物流",type:9}],visible1:!1,visible3:!1,visible4:!1},computed:{orderAddressValue:function(){if(this.orderAddress.value)return this.orderAddress.value.replace(/,/g,"-")+"-"},isPersonal:function(){return r.a.getStorageSync("isPersonal")&&1==r.a.getStorageSync("isPersonal")?1:0}},methods:{pageTo:function(t,s){n()(this,this.$options.data()),this.$router.replace({path:t,query:{orderId:s}})},closeOrder:function(t){var s=this;this.$API.L_shopClose({orderId:t}).then(function(t){r.a.showToast({title:"已取消",icon:"success"}),setTimeout(function(){s.pageStart()},1e3)})},getOrderDetail:function(t){return this.$API.L_selectOrderDetail({orderId:t})},handle:function(t){console.log(t.mp.detail.value),this.index=t.mp.detail.value},getRefundOrderDetail:function(t){return this.$API.L_selectOrderRefundDetail({orderRefundId:t})},togglePopups:function(t){this.showPopups=!0,this.popupsIndex=t,this.isEdited=!1},cancelExpress:function(){this.showLogistics=!this.showLogistics},confirmExpress:function(t){var s=this;if(this.noExpress)this.confirmShip({orderId:t}).then(function(t){r.a.showToast({title:"已发货",icon:"success"}),s.showLogistics=!1,setTimeout(function(){s.pageStart()},1500)});else{if(0===this.index)return void r.a.showToast({title:"请选择物流公司",icon:"none"});if(!this.logisticsNo)return void r.a.showToast({title:"请填写物流单号",icon:"none"});if(this.logisticsNo.length>14)return void r.a.showToast({title:"快递单号长度最长14位",icon:"none"});this.confirmShip({orderId:t,logisticsNo:this.logisticsNo,image:this.imgList.toString(),type:1}).then(function(t){r.a.showToast({title:"已发货",icon:"success"}),s.showLogistics=!1,setTimeout(function(){s.pageStart()},1500)})}},togglenoExpress:function(){this.noExpress=!this.noExpress,console.log(this.noExpress)},confirmShip:function(t){return this.$API.L_deliverGoods(t)},cancelModel:function(){this.showPopups=!1,this.showLogistics=!1,this.popupsIndex=-1},ship:function(t){this.isEdited&&this.lastSkuList&&this.lastSkuList.every(function(t){return t.every(function(t){return 0===t.deliver})})?this.visible1=!this.visible1:this.showLogistics=!this.showLogistics},bindButtonTapImage:function(){var t=this.maxNum;r.a.showLoading({title:"加载中"});var s=this;if(t&&this.imgList.length>=t)return this.handleError("不能超过"+t+"张图片噢！"),void r.a.hideLoading();r.a.chooseImage({sizeType:"original",count:this.uploadNum,success:function(t){console.log(t);var i=t.tempFilePaths;console.log(i),i.forEach(function(t){s.uploadImg(t)})},fail:function(){r.a.showLoading({title:"操作失败"})},complete:function(){r.a.hideLoading()}})},uploadImg:function(t){var s=t.lastIndexOf("/")+1,i=this;r.a.uploadFile({url:l.a.uploadImageUrl,filePath:t,name:"file",formData:{name:t.slice(s).toString(),key:"img/${filename}",policy:l.a.imgPolicy,OSSAccessKeyId:l.a.OSSAccessKeyId,success_action_status:"200",signature:l.a.imgSignature},success:function(e){if(console.log(e),console.log("tempFilePath  ========",t),400==parseInt(e.statusCode))i.handleError("上传的图片大小不能超过2m!");else if(200==parseInt(e.statusCode)){if(i.maxNum&&i.imgList.length>=i.maxNum)return void i.handleError("不能超过6张图片噢！");i.imgList.push(l.a.uploadImageUrl+"/img/"+t.slice(s).toString()),console.log("图片列表===>"+i.imgList),i.getImg(l.a.uploadImageUrl+"/img/"+t.slice(s).toString())}},fail:function(t){console.log(t)}}).onProgressUpdate(function(t){100===t.progress&&r.a.showToast({title:"上传完成"})})},getImg:function(t){this.imageList.push(t),console.log("imageList ===> "+this.imageList)},handleError:function(t){this.$Message({content:t,type:"error"})},cut:function(t,s){this.$set(this.lastSkuList[t],s,{deliver:this.lastSkuList[t][s].deliver-=1,color:this.lastSkuList[t][s].color,size:this.lastSkuList[t][s].size,num:this.lastSkuList[t][s].num,remain:this.lastSkuList[t][s].remain,skuId:this.lastSkuList[t][s].skuId}),console.log(this.lastSkuList[t])},add:function(t,s){this.$set(this.lastSkuList[t],s,{deliver:this.lastSkuList[t][s].deliver+=1,color:this.lastSkuList[t][s].color,size:this.lastSkuList[t][s].size,num:this.lastSkuList[t][s].num,remain:this.lastSkuList[t][s].remain,skuId:this.lastSkuList[t][s].skuId}),console.log(this.lastSkuList[t])},cancel:function(t){this.showPopups=!1,this.popupsIndex=-1},save:function(){var t=[],s=this;this.lastSkuList.forEach(function(s,i){s.forEach(function(s){t.push({num:s.deliver,skuId:s.skuId})})});r.a.getAccountInfoSync().miniProgram.appId;r.a.showLoading(),this.$API.goodsAddChildren({orderIds:s.orderId,orderDeliver:t}).then(function(t){t.data;var i=t.code,e=t.desc;1===i?(console.log(t),s.showEditTable=!0,s.isEdited=!0,s.skuList=JSON.parse(a()(s.lastSkuList)),console.log(s.isEdited)):r.a.showToast({title:e,icon:"none",duration:1500})}).catch(function(t){r.a.showToast({title:"编辑失败",icon:"none"})}).finally(function(){r.a.hideLoading(),s.showPopups=!1,s.popupsIndex=-1})},toggleModal:function(t){console.log("点击事件执行"),this[t]=!this[t]},pageStart:function(){var t=this;this.showLogistics=!1,console.log(this.showLogistics),this.$route.query.orderId&&(this.orderId=this.$route.query.orderId,this.getOrderDetail(this.orderId).then(function(s){if(console.log(s),t.state=s.data.state,s.data.orderAddress&&(t.orderAddress=s.data.orderAddress),t.goodsList=s.data.goodsList,t.goodsList){var i=[];t.goodsList.forEach(function(t,s){i.push([]),t.orderGoods.forEach(function(t){i[s].push({color:t.skuCode.split(",")[0].toString(),size:t.skuCode.split(",")[1].toString(),num:t.num,deliver:t.num,remain:t.remainNum,skuId:t.skuId})})}),t.skuList=i,t.lastSkuList=i}if(t.orderNo=s.data.orderNo,t.createTime=s.data.createTime,t.isPing=s.data.isPing,t.totalPrice=s.data.paid,t.freight=s.data.freight,1===s.data.isHasChildren?(t.isHasChildren=1,t.childrenOrder=s.data.children):(t.isHasChildren=0,t.childrenOrder=[]),s.data.payTime?t.payTime=s.data.payTime:t.payTime="",s.data.remark?t.remark=s.data.remark:t.remark="",s.data.deliverTime?t.deliverTime=s.data.deliverTime:t.deliverTime="",s.data.receiptTime?t.receiptTime=s.data.receiptTime:t.receiptTime="",s.data.couponMoney?t.couponMoney=s.data.couponMoney:t.couponMoney=0,s.data.pingTime?t.pingTime=s.data.pingTime:t.pingTime="",s.data.parent?t.parentNo=s.data.parent.orderNo:t.parentNo="",s.data.pingUser?t.pingUser=s.data.pingUser:t.pingUser=[],t.isHasDeliver=s.data.isHasDeliver,t.isHasDeliver){var e=[];t.goodsList.forEach(function(t,s){e.push([]),t.deliverList.forEach(function(t){e[s].push({color:t.skuCode.split(",")[0].toString(),size:t.skuCode.split(",")[1].toString(),num:t.num,deliver:t.canDeliverNumber,remain:t.remainNum})})}),t.deliverList=e,console.log("this.deliverList",t.deliverList)}else t.deliverList=[]})),r.a.getStorageSync("dpName")&&(this.shopName=r.a.getStorageSync("dpName"))}},mounted:function(){this.pageStart()},onUnload:function(){n()(this,this.$options.data())}}},JF7t:function(t,s,i){"use strict";var e=i("7WCK"),a=i("Xpyf");var o=function(t){i("zLbf")},n=i("ybqe")(e.a,a.a,o,"data-v-68f90aa0",null);s.a=n.exports},Xpyf:function(t,s,i){"use strict";var e={render:function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"wrapper"},[i("div",{staticClass:"receiver"},[i("div",{staticClass:"left-icon"}),t._v(" "),i("div",{staticClass:"right-info"},[i("div",{staticClass:"header"},[i("span",{staticClass:"name"},[t._v("收货人: "+t._s(t.orderAddress.name||"未知联系人"))]),t._v(" "),i("span",{staticClass:"mobile"},[t._v(t._s(t.orderAddress.mobile||"未知号码"))])]),t._v(" "),i("div",{staticClass:"address"},[t._v("收货地址: "+t._s(t.orderAddressValue+t.orderAddress.address))]),t._v(" "),i("div",{staticClass:"remark"},[t._v("备注: "+t._s(t.remark))])])]),t._v(" "),i("div",{staticClass:"orderDetail"},[i("div",{staticClass:"header"},[i("span",{staticClass:"left"},[i("i",{staticClass:"icon"}),t._v(t._s(t.shopName)+"\n        ")],1),t._v(" "),i("span",{staticClass:"right"},[t._v(t._s(1===t.state?"等待支付":2===t.state?"已取消":5===t.state?"待发货":6===t.state?"已发货":7===t.state?"交易成功":8===t.state?"交易关闭":9===t.state?"拼单中":10===t.state?"审核中":"未知状态"))])]),t._v(" "),t._l(t.goodsList,function(s,e){return i("div",{key:e,staticClass:"goods-info"},[i("div",{staticClass:"goods-body"},[i("i",{staticClass:"goods-img",style:{backgroundImage:"url("+s.image+")"}}),t._v(" "),i("div",{staticClass:"goods-message"},[i("span",{staticClass:"name"},[t._v(t._s(s.name))]),t._v(" "),i("span",[i("p",{staticClass:"stall"},[t._v("档口名称: "+t._s(s.stallInfo3||"未知档口"))]),t._v(" "),i("p",{staticClass:"futures"},[t._v("期货: "+t._s(s.delivery||"未知期货"))])],1),t._v(" "),i("div",{staticClass:"footer"},[i("div",{staticClass:"box"},t._l(t.skuList[e],function(s,e){return i("span",{key:e},[t._v(t._s(s.color)+"色: "+t._s(s.size)+"码丨"+t._s(s.num)+"件")])})),t._v(" "),i("button",{directives:[{name:"show",rawName:"v-show",value:5===t.state,expression:"state === 5"}],attrs:{eventid:"0-"+e},on:{click:function(s){t.togglePopups(e)}}},[t._v("编辑")])],1)])],1),t._v(" "),5==t.state&&t.isHasDeliver&&!t.isEdited?i("div",{staticClass:"table"},[i("table",{staticStyle:{border:"none"}},[i("tr",[i("th",[t._v("颜色")]),t._v(" "),i("th",[t._v("码数")]),t._v(" "),i("th",[t._v("总件数")]),t._v(" "),i("th",[t._v("剩余待发")]),t._v(" "),i("th",[t._v("发货数")])],1),t._v(" "),t._l(t.deliverList[e],function(s,e){return i("tr",{key:e},[i("td",[t._v(t._s(s.color))]),t._v(" "),i("td",[t._v(t._s(s.size))]),t._v(" "),i("td",[t._v(t._s(s.num))]),t._v(" "),i("td",[t._v(t._s(s.remain))]),t._v(" "),i("td",[t._v(t._s(s.deliver))])],1)})],2)],1):t._e(),t._v(" "),t.isEdited?i("div",{staticClass:"table"},[i("table",{staticStyle:{border:"none"}},[i("tr",[i("th",[t._v("颜色")]),t._v(" "),i("th",[t._v("码数")]),t._v(" "),i("th",[t._v("总件数")]),t._v(" "),i("th",[t._v("剩余待发")]),t._v(" "),i("th",[t._v("发货数")])],1),t._v(" "),t._l(t.skuList[e],function(s,e){return i("tr",{key:e},[i("td",[t._v(t._s(s.color))]),t._v(" "),i("td",[t._v(t._s(s.size))]),t._v(" "),i("td",[t._v(t._s(s.num))]),t._v(" "),i("td",[t._v(t._s(s.remain))]),t._v(" "),i("td",[t._v(t._s(s.deliver))])],1)})],2)],1):t._e(),t._v(" "),i("div",{staticClass:"total"},[t._v("\n        共"+t._s(s.countNum)+"件商品, 合计: "),i("strong",[t._v(t._s(s.countPrice)+"元")])],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.popupsIndex===e,expression:"popupsIndex === goodsIndex"}],staticClass:"popups"},[i("table",[i("tr",{staticClass:"header"},[i("th",[t._v("颜色")]),t._v(" "),i("th",[t._v("码数")]),t._v(" "),i("th",[t._v("总件数")]),t._v(" "),i("th",[t._v("剩余待发")]),t._v(" "),i("th",{staticClass:"col-2"},[t._v("发货数")])],1),t._v(" "),t._l(t.lastSkuList[e],function(s,a){return i("tr",{key:a},[i("td",[t._v(t._s(s.color))]),t._v(" "),i("td",[t._v(t._s(s.size))]),t._v(" "),i("td",[t._v(t._s(s.num))]),t._v(" "),i("td",[t._v(t._s(s.remain))]),t._v(" "),i("td",{staticClass:"col-2"},[i("button",{attrs:{disabled:0===s.deliver,eventid:"1-"+e+"-"+a},on:{click:function(s){t.cut(e,a)}}},[t._v("-")]),t._v(" "),i("span",{staticClass:"edit"},[t._v(t._s(s.deliver))]),t._v(" "),i("button",{attrs:{disabled:s.deliver===s.remain,eventid:"2-"+e+"-"+a},on:{click:function(s){t.add(e,a)}}},[t._v("+")])],1)],1)})],2),t._v(" "),i("div",{staticClass:"btn-group"},[i("button",{staticClass:"cancel",attrs:{type:"button",eventid:"3-"+e},on:{click:function(s){t.cancel(e)}}},[t._v("取消")]),t._v(" "),i("button",{staticClass:"save",attrs:{type:"button",eventid:"4-"+e},on:{click:function(s){t.save()}}},[t._v("保存")])],1)],1)])})],2),t._v(" "),0!==t.childrenOrder.length?i("ul",{staticClass:"childOrder"},t._l(t.childrenOrder,function(s,e){return i("li",{key:e,attrs:{eventid:"5-"+e},on:{click:function(i){t.pageTo("/pages/home/orderMgr/orderdetail",s.id)}}},[t._v("\n      子订单编号("+t._s(1===s.state?"等待支付":2===s.state?"已取消":5===s.state?"待发货":6===s.state?"已发货":7===s.state?"交易成功":8===s.state?"交易关闭":9===s.state?"拼单中":10===s.state?"审核中":"未知状态")+"):\n      "+t._s(s.orderNo))])})):t._e(),t._v(" "),i("ul",{staticClass:"orderPrice"},[i("li",[i("span",{staticClass:"title"},[t._v("商品总价")]),t._v(" "),i("span",{staticClass:"num"},[t._v("￥"+t._s(t.totalPrice))])]),t._v(" "),t.couponMoney?i("li",[i("span",{staticClass:"title"},[t._v("优惠券抵扣")]),t._v(" "),i("span",{staticClass:"num"},[t._v("- ￥"+t._s(t.couponMoney))])]):t._e(),t._v(" "),i("li",[i("span",{staticClass:"title"},[t._v("运费")]),t._v(" "),i("span",{staticClass:"num"},[t._v("+ ￥"+t._s(t.freight))])])],1),t._v(" "),i("ul",{staticClass:"orderNo"},[t.parentNo?i("li",[t._v("父订单编号: "+t._s(t.parentNo))]):t._e(),t._v(" "),i("li",[t._v("订单编号: "+t._s(t.orderNo))]),t._v(" "),i("li",[t._v("下单时间: "+t._s(t.createTime))]),t._v(" "),t.payTime?i("li",[t._v("支付时间: "+t._s(t.payTime))]):t._e(),t._v(" "),t.pingTime?i("li",[t._v("拼团时间: "+t._s(t.pingTime))]):t._e(),t._v(" "),t.deliverTime?i("li",[t._v("发货时间: "+t._s(t.deliverTime))]):t._e(),t._v(" "),t.receiptTime?i("li",[t._v("确认收货时间: "+t._s(t.receiptTime))]):t._e()],1),t._v(" "),i("div",{staticClass:"white-block",staticStyle:{width:"100%",height:"100px","background-color":"#fff"}}),t._v(" "),i("div",{staticClass:"btn"},[t.pingUser?i("div",{staticClass:"pingUser"},t._l(t.pingUser,function(s,e){return e<3?i("i",{key:e,style:{backgroundImage:"url("+s.head+")"}}):t._e()})):t._e(),t._v(" "),5===t.state?i("button",{attrs:{eventid:"6"},on:{click:function(s){t.ship(t.orderId)}}},[t._v("发货")]):t._e(),t._v(" "),6===t.state&&1!==t.isHasChildren?i("button",{attrs:{eventid:"7"},on:{click:function(s){t.pageTo("/pages/home/orderMgr/logisticsDetail",t.orderId)}}},[t._v("查看物流")]):t._e(),t._v(" "),4===t.state?i("button",[t._v("确认收货")]):t._e(),t._v(" "),1===t.state&&0===t.isPersonal?i("button",[t._v("确认已支付")]):t._e(),t._v(" "),1===t.state?i("button",{attrs:{eventid:"8"},on:{click:function(s){t.toggleModal("visible3")}}},[t._v("取消订单")]):t._e()],1),t._v(" "),t.showLogistics?i("div",{staticClass:"logistics"},[i("div",{staticClass:"wrapper"},[i("div",{staticClass:"title"},[t._v("请填写物流信息")]),t._v(" "),i("ul",{staticClass:"body"},[i("li",[t._v("\n          物流公司:\n          "),i("div",{staticClass:"selector-picker"},[i("picker",{attrs:{mode:"selector",value:t.index,range:t.companies,"range-key":"text",eventid:"9"},on:{change:t.handle}},[i("div",{staticClass:"picker"},[t._v("\n                "+t._s(t.companies[t.index].text)+"\n              ")])])],1)]),t._v(" "),i("li",[t._v("\n          快递单号:\n          "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.logisticsNo,expression:"logisticsNo"}],attrs:{type:"number",placeholder:"请填写快递单号",eventid:"10"},domProps:{value:t.logisticsNo},on:{input:function(s){s.target.composing||(t.logisticsNo=s.target.value)}}})]),t._v(" "),i("li",[t._v("上传快递信息凭证: ")]),t._v(" "),i("li",{staticClass:"upload-img"},[i("scroll-view",{staticClass:"scroll-view",staticStyle:{height:"220rpx"},attrs:{"scroll-y":""}},[t._l(t.imageList,function(t,s){return i("div",{key:s,staticClass:"img-box"},[i("i",{staticClass:"img",style:{backgroundImage:"url("+t+")"}})],1)}),t._v(" "),i("div",{staticClass:"img-box"},[i("i",{staticClass:"add-img",attrs:{eventid:"11"},on:{tap:t.bindButtonTapImage}},[t._v("\n                + 可上传图片\n              ")])],1)],2)],1),t._v(" "),i("li",{staticClass:"checkbox"},[i("i",{staticClass:"select-icon",class:[t.noExpress?"active":""],attrs:{eventid:"12"},on:{click:function(s){t.togglenoExpress()}}}),t._v("\n          无物流信息\n        ")],1)],1),t._v(" "),i("div",{staticClass:"footer"},[i("span",{staticClass:"cancel",attrs:{eventid:"13"},on:{click:function(s){t.cancelExpress()}}},[t._v("取消")]),t._v(" "),i("span",{staticClass:"ok",attrs:{eventid:"14"},on:{click:function(s){t.confirmExpress(t.orderId)}}},[t._v("确定发货")])])],1)]):t._e(),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.showLogistics||t.showPopups,expression:"showLogistics || showPopups"}],staticClass:"mark",attrs:{eventid:"15"},on:{click:t.cancelModel}}),t._v(" "),i("i-modal",{attrs:{title:"请检查...",visible:t.visible1,eventid:"16",mpcomid:"0"},on:{ok:function(s){t.toggleModal("visible1")},cancel:function(s){t.toggleModal("visible1")}}},[i("div",[t._v("未编辑待发货数量")])]),t._v(" "),i("i-modal",{attrs:{visible:t.visible3,eventid:"17",mpcomid:"1"},on:{ok:function(s){t.closeOrder(t.orderId)},cancel:function(s){t.toggleModal("visible3")}}},[i("div",{staticClass:"visible"},[t._v("确定取消订单？")])]),t._v(" "),i("i-modal",{attrs:{visible:t.visible4,eventid:"18",mpcomid:"2"},on:{ok:function(s){t.closeOrder(t.orderItem.id)},cancel:function(s){t.toggleModal("visible4")}}},[i("div",{staticClass:"visible"},[t._v("确定关闭订单？")])]),t._v(" "),i("i-message",{attrs:{id:"message",mpcomid:"3"}})],1)},staticRenderFns:[]};s.a=e},zLbf:function(t,s){}},["BQ9p"]);