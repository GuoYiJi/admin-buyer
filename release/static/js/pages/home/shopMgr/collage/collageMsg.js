global.webpackJsonp([37],{"+lWb":function(t,e){},"+t5x":function(t,e,i){"use strict";var s=i("xaYj"),a=i("/mYh");var n=function(t){i("+lWb")},o=i("ybqe")(s.a,a.a,n,"data-v-08f08ffd",null);e.a=o.exports},"/mYh":function(t,e,i){"use strict";var s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"home"},[i("ul",{staticClass:"line-box"},[i("li",[i("span",{staticClass:"title"},[t._v("成团数量: ")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.personNum,expression:"personNum"}],staticClass:"input_text",attrs:{type:"number",placeholder:"请输入成团数量",eventid:"0"},domProps:{value:t.personNum},on:{input:function(e){e.target.composing||(t.personNum=e.target.value)}}})]),t._v(" "),i("li",{staticClass:"more"},[i("span",{staticClass:"title"},[t._v("生效时间: ")]),t._v(" "),i("p",{staticClass:"blur"},[i("picker",{attrs:{mode:"date",value:t.setDate,start:t.startDate,eventid:"1"},on:{change:t.bindDateChange}},[i("view",{staticClass:"picker"},[t._v("\n            "+t._s(t.setDate?t.setDate:"未设置")+"\n          ")])])],1)],1),t._v(" "),i("li",{staticClass:"more"},[i("span",{staticClass:"title"},[t._v("过期时间: ")]),t._v(" "),i("p",{staticClass:"blur"},[i("picker",{attrs:{mode:"date",value:t.setEndDate,start:t.startEndDate,eventid:"2"},on:{change:t.bindEndDateChange}},[i("view",{staticClass:"picker"},[t._v("\n            "+t._s(t.setEndDate?t.setEndDate:"未设置")+"\n          ")])])],1)],1),t._v(" "),i("li",[i("span",{staticClass:"title"},[t._v("限购次数: ")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.limitTimes,expression:"limitTimes"}],staticClass:"input_text",attrs:{type:"number",placeholder:"请输入限购次数",eventid:"3"},domProps:{value:t.limitTimes},on:{input:function(e){e.target.composing||(t.limitTimes=e.target.value)}}})]),t._v(" "),i("li",[i("span",{staticClass:"title"},[t._v("限购件数: ")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.limitNum,expression:"limitNum"}],staticClass:"input_text",attrs:{type:"number",placeholder:"请输入限购件数",eventid:"4"},domProps:{value:t.limitNum},on:{input:function(e){e.target.composing||(t.limitNum=e.target.value)}}})]),t._v(" "),t.isEdit?i("li",[i("span",{staticClass:"title"},[t._v("拼团价: ")]),t._v(" "),i("span",{staticClass:"inputPrice"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.price,expression:"price"}],staticClass:"input_text",attrs:{type:"digit",eventid:"5"},domProps:{value:t.price},on:{input:function(e){e.target.composing||(t.price=e.target.value)}}}),t._v(" "),i("p",[t._v("元")])],1)]):i("li",{attrs:{eventid:"6"},on:{click:function(e){t.toRoute("shopList")}}},[i("span",{staticClass:"title"},[t._v("可使用的商品: ")]),t._v(" "),i("p",{staticClass:"blur"},[t._v("\n        "+t._s(t.showShop)+"\n      ")])],1)],1),t._v(" "),i("i-toast",{attrs:{id:"toast",mpcomid:"0"}}),t._v(" "),i("i-message",{attrs:{id:"message",mpcomid:"1"}}),t._v(" "),i("div",{staticClass:"footer"},[t.isEdit?i("p",{staticClass:"save",attrs:{eventid:"8"},on:{click:function(e){t.editGroup()}}},[t._v("保存编辑")]):i("p",{staticClass:"save",attrs:{eventid:"7"},on:{click:function(e){t.createGroup()}}},[t._v("保存创建")])],1)],1)},staticRenderFns:[]};e.a=s},xaYj:function(t,e,i){"use strict";var s=i("Dd8w"),a=i.n(s),n=i("qTHA"),o=i("QmSG"),r=i("90m7"),l=i("NYxO");e.a={mixins:[r.a],components:{},data:function(){return{startDate:new Date,setDate:"",setEndDate:"",startEndDate:new Date((new Date).getTime()+864e5),addShop:"",limitNum:0,limitTimes:0,personNum:0,price:0,selIds:[],requestData:[],url:"",isEdit:!1,goodsId:"",id:""}},computed:a()({},Object(l.b)(["shopSelectList"]),{showShop:function(){return this.shopSelectList.length>0?(console.log(this.shopSelectList),"已选择"+this.shopSelectList.length+"件"):"去添加商品"}}),methods:{createGroup:function(){var t=this;if(console.log(this.shopSelectList),this.personNum)if(this.setDate)if(this.setEndDate)if(this.limitTimes)if(this.limitNum)if(1!=this.isEdit||this.price)if(0==this.shopSelectList.length)this.$Toast({content:"请选择商品",type:"warning"});else{this.shopSelectList.forEach(function(e,i){t.requestData[i]={num:t.personNum,startTime:t.setDate.split(" ")[0].toString(),endTime:t.setEndDate.split(" ")[0].toString(),limitNum:t.limitNum,limitTimes:t.limitTimes,price:e.groupPrice,goodsId:e.id}});var e=this,i=n.a.getAccountInfoSync().miniProgram.appId;n.a.request({url:e.url+"/api/shop/ping/addPing",data:{pingList:e.requestData,sessionId:n.a.getStorageSync("production_sessionId"),shopId:i},method:"POST",header:{"content-type":"application/json"},success:function(t){console.log(t.data),1==t.data.code&&(e.$Toast({content:"创建拼团成功",duration:1e3,type:"success"}),setTimeout(function(){e.$router.back(-1)},1e3))}})}else this.$Toast({content:"请填写拼团价",type:"warning"});else this.$Toast({content:"请限制件数",type:"warning"});else this.$Toast({content:"请限制次数",type:"warning"});else this.$Toast({content:"请设置过期时间",type:"warning"});else this.$Toast({content:"请设置生效时间",type:"warning"});else this.$Toast({content:"请填写成团人数",type:"warning"})},editGroup:function(){var t=this,e=n.a.getAccountInfoSync().miniProgram.appId;n.a.request({url:this.url+"/api/shop/ping/editPing",data:{num:this.personNum,startTime:this.setDate,endTime:this.setEndDate,limitNum:this.limitNum,limitTimes:this.limitTimes,price:this.price,id:this.goodsId,sessionId:n.a.getStorageSync("production_sessionId"),shopId:e},method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},success:function(e){console.log(e.data),n.a.showToast({title:"编辑成功",icon:"success"}),1===e.data.code&&setTimeout(function(){t.$router.back(-1)},1200)}})},bindDateChange:function(t){console.log("picker发送选择改变，携带值为",t.mp.detail.value),this.setEndDate&&+new Date(this.setEndDate)<+new Date(t.mp.detail.value)?this.handleError("生效时间不能大于过期时间！"):this.setDate=t.mp.detail.value},bindEndDateChange:function(t){console.log(t),console.log("picker发送选择改变，携带值为",t.mp.detail.value),this.setDate?+new Date(this.setDate)>+new Date(t.mp.detail.value)?this.handleError("生效时间不能大于过期时间！"):this.setEndDate=t.mp.detail.value:this.handleError("请先设置生效时间！")},toRoute:function(t){this.$router.push({path:"/pages/home/shopMgr/"+t,query:{type:"collage"}})}},mounted:function(){if(console.log(this.$route.query),"true"===this.$route.query.isEdit?this.isEdit=!0:(console.log("数据初始化===>"),this.isEdit=!1,this.setDate="",this.setEndDate="",this.limitNum="",this.limitTimes="",this.personNum="",this.price="",this.goodsId="",this.$store.commit("DELETE_ROUNPPRICE",[])),this.$route.query.pingInfo){var t=JSON.parse(this.$route.query.pingInfo);console.log(t),this.personNum=t.num,this.limitNum=t.limitNum,this.limitTimes=t.limitTimes,this.setDate=t.startTime.split(" ")[0].toString(),this.setEndDate=t.endTime.split(" ")[0].toString(),this.goodsId=t.id,this.price=t.price}this.url=o.a.url}}}},["NDi6"]);