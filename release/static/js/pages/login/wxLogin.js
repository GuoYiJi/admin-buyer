global.webpackJsonp([18],{"2Jy8":function(e,n,t){"use strict";var r=t("Xxa5"),a=t.n(r),s=t("exGp"),o=t.n(s),c=t("qTHA"),i=t("90m7");t("QmSG");n.a={mixins:[i.a],components:{},data:function(){return{userInfoBool:!1,userInfo:{},code:""}},computed:{showBtn:function(){return this.userInfoBool}},methods:{getPhoneNumber:function(e){var n=this;return o()(a.a.mark(function t(){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.mp.detail.encryptedData){t.next=4;break}n.handleError("需要同意授权才可以使用噢！"),t.next=10;break;case 4:return t.next=6,c.a.getStorageSync("sessionId");case 6:if(!t.sent){t.next=9;break}return t.abrupt("return",c.a.switchTab({url:"/pages/home/home"}));case 9:n.login(e.mp.detail);case 10:case"end":return t.stop()}},t,n)}))()},getUserInfo:function(e){console.log(e),e.mp.detail.encryptedData?(this.userInfoBool=!0,this.userInfo=e.mp.detail,this.login(e.mp.detail)):this.handleError("需要同意授权才可以使用噢！")},login:function(e){var n=this;return o()(a.a.mark(function t(){var r;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.$API.authLogin({code:n.code,avatar:n.userInfo.userInfo.avatarUrl,nick:n.userInfo.userInfo.nickName,encryptedDataPhone:e.encryptedData,ivPhone:e.iv,encryptedData:n.userInfo.encryptedData,iv:n.userInfo.iv});case 3:return r=t.sent,t.next=6,c.a.setStorageSync("production_sessionId",r.data.sessionId);case 6:return c.a.setStorageSync("is-login",!0),t.next=9,c.a.setStorageSync("avatar",r.data.avatar);case 9:c.a.switchTab({url:"/pages/home/home"}),t.next=14;break;case 12:t.prev=12,t.t0=t.catch(0);case 14:case"end":return t.stop()}},t,n,[[0,12]])}))()}},mounted:function(){var e=this;return o()(a.a.mark(function n(){return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:c.a.login({success:function(){var n=o()(a.a.mark(function n(t){return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:t.code?(e.code=t.code,c.a.getUserInfo({success:function(n){e.userInfoBool=!0,e.userInfo=n},fail:function(e){}})):console.log("登录失败！"+t.errMsg);case 1:case"end":return n.stop()}},n,e)}));return function(e){return n.apply(this,arguments)}}(),fail:function(){self.handleError("授权失败！")}});case 1:case"end":return n.stop()}},n,e)}))()}}},"5R0q":function(e,n,t){"use strict";var r={render:function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"home"},[t("div",{staticClass:"login"},[e.userInfo.userInfo?t("p",[t("img",{staticClass:"icon_wx",attrs:{src:e.userInfo.userInfo.avatarUrl}})]):t("p",[t("i",{staticClass:"icon_wx"})],1),e._v(" "),t("p",[e._v(e._s(e.userInfo.userInfo?e.userInfo.userInfo.nickName:"微信登陆"))])],1),e._v(" "),t("i-message",{attrs:{id:"message",mpcomid:"0"}}),e._v(" "),e.userInfoBool?e._e():t("button",{staticClass:"user_btn wx_btn",attrs:{"open-type":"getUserInfo",eventid:"0"},on:{getuserinfo:e.getUserInfo}},[e._v("获取用户信息")]),e._v(" "),e.userInfoBool?t("button",{staticClass:"wx_btn",attrs:{"open-type":"getPhoneNumber",eventid:"1"},on:{getphonenumber:e.getPhoneNumber}},[e._v("授权登陆")]):e._e()],1)},staticRenderFns:[]};n.a=r},TE2T:function(e,n){},xe5A:function(e,n,t){"use strict";var r=t("2Jy8"),a=t("5R0q");var s=function(e){t("TE2T")},o=t("ybqe")(r.a,a.a,s,"data-v-5d532e58",null);n.a=o.exports}},["w6IV"]);